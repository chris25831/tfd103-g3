<!DOCTYPE html>
<html lang="zh-tw">
<head>
    <meta charset="UTF-8">
    <meta name="keywords" content="三鐵,三鐵訓練,triathlon">  
    <meta name="description" content="幫助想參加三鐵賽事的人製作訓練計畫表，且提供相關訓練課程">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--要記得改頁面標題! 統一範例:你的頁面名稱 | Triclub-->
    <title>討論區 | Triclub</title> 
    <!--從scss轉譯過來的-->
    <link rel="stylesheet" href="css/style.css">
    <!--font-awesome-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css" integrity="sha512-YWzhKL2whUzgiheMoBFwW8CKV4qpHQAEuvilg9FAn5VJUDwKZZxkJNuGM4XkWuk94WCrrwslk8yWNGmY1EduTA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    
</head>

<body>
    <!--這是header-->
    <header id="header" :class="{sticky: active}">
        <my-header></my-header><!--這是自定義標籤會被覆蓋-->
    </header>


    <!--內容所有都放在這div裡面-->
    
    <main class="forum-content main" id="forum-content">
        <!-- <div class="bookmark-frontend">
            <bookmark-forum v-for="(category, index) in categories" :key="index" :category="category">
        </div> -->
        
        <div class="back">
            <!-- 回上一頁按鈕放置處 -->
            <div class="button-block-frontend back-post">
                <a href="./forum-home.html">
                    <div class="previouspage change-display">
                        <div class="arrow"></div>
                    </div>
                </a>

                <!-- <button class="new-post" @click="openModal">發表文章</button> -->
            </div>
        </div>

        <div class="page-container-single-article">
            <div class="single-article">
                <div class="head">
                    <div class="author">
                        <img class="avatar" :src="singleArticleData.UserPhoto" alt="">
                        <span class="name">{{singleArticleData.PostID}}</span>
                        <span class="time">{{singleArticleData.PostDate}}</span>
                    </div>
                    <div class="action">
                        <div class="like">
                            <img class="heart" @click="clickLike" v-show="likeSwitch" src="./src/images/img/forum/heart-size-3.png" alt="">
                            <img class="heart heart-red" @click="clickLike" v-show="likeSwitchForRed" src="./src/images/img/forum/heart-red.png" alt="">
                        </div>
                        <div class="report">
                            <img src="./src/images/img/forum/report-button.png" @click="dropDownSwitch">
                            <div class="drop-down" v-show="showReport">
                                <span @click="report">檢舉</span>
                                <span @click="openEditModal">編輯</span>
                                <span @click="deletePost">刪除</span>
                            </div>  
                        </div>
                        
                    </div>
                </div>
                <div class="middle">
                    <h3 class="title">{{singleArticleData.PostTitle}}</h3>
                    
                    <div class="forum-content-block">
                        <p class="manage-forum-content">
                            {{singleArticleData.PostContent}}
                        </p>
                        <div class="photo-block" v-if="showPhotoBlock">
                            <img src="" alt="" class="photo-one">
                            <img src="" alt="" class="photo-two">
                            <img src="" alt="" class="photo-three">
                        </div>
                        
                    </div>
                </div>
            
            </div>

            <div class="new-comment">
                <img class="avatar avatar-new-comment" src="./src/images/img/forum/smile.jpg" alt="">
                <textarea class="input-comment" placeholder="留言..." name="" id=""></textarea>
                <div class="button-block-frontend">
                    <button class="submit-comment small-blue">留言</button>
                </div>
            </div>

            <hr>

            <div class="comments">
                <div class="single-comment" v-for="comment in commentData" :data-id="comment.CommentId">
                    <div class="comment-author">
                        <img class="avatar avatar-comment" src="./src/images/img/forum/smile.jpg" alt="">
                        <span class="name">?????</span>
                        <span class="time">??????</span>
                    </div>
                    <p class="comment-content">
                        ?????????????
                    </p>
                    <div class="report">
                        <img src="./src/images/img/forum/report-button.png">
                        <div class="drop-down-comment">
                            <span>檢舉</span>
                        </div>  
                    </div>
                    
                </div>
                
                
            </div>
        </div>
        
        <report @cancel-report="closeReportModal" v-if="showReportModal"></report>
        
        <!-- 點擊編輯文章後彈出 -->
        <div class="darken-background forum-edit-post-modal" v-if="showModal">
            <div class="new-article forum-modal">
                    
                    <span class="info">編輯文章</span>

                    <div class="cross"> 
                        <i @click="closeEditModal" class="fas fa-times fa-2x"></i>
                    </div>

                    <input type="text" class="title forum-title" placeholder="請輸入文章標題" name="title" v-model="forumTitle" required>

                    <select class="category" name="category" id="" v-model="category" required>
                        <option value="閒聊">閒聊</option>
                        <option value="裝備">裝備</option>
                        <option value="心得">心得</option>
                        <option value="問題">問題</option>
                    </select>

                    <textarea class="new-article-content" name="content" id="" cols="30" rows="10" v-model="articleContent" required></textarea>

                    <div class="upload-images">
                        <div class="single-image image-one-wrapper" @dragover.prevent @drop.prevent="dropFirstImage" >
                            <div class="rectangle rectangle-one"></div>
                            <img class="the-image-one the-image" src="" name="photo-one">
                        </div>

                        <div class="single-image image-two-wrapper" @dragover.prevent @drop.prevent="dropSecondImage">
                            <div class="rectangle rectangle-two"></div>
                            <img class="the-image-two the-image" src="" name="photo-two">
                        </div>

                        <div class="single-image image-three-wrapper" @dragover.prevent @drop.prevent="dropThirdImage">
                            <div class="rectangle rectangle-three"></div>
                            <img class="the-image-three the-image" src="" name="photo-three">
                        </div>
                    </div>
                    
                    <button class="send-forum-content" type="submit" @click="send">送出</button>
            </div>
        </div>
        <!-- 以上為編輯文章 -->

    </main>
    
    <!--這是footer-->
    <footer id="footer">
        <my-footer></my-footer><!--這是目標標籤會被覆蓋-->
    </footer>


<!--header/footer component-->
<script src="./src/js/vue.js"></script>
<script src="./src/js/vuex.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.23.0/axios.min.js"></script>
<script src="./src/component/common/header.js"></script>
<script src="./src/component/common/footer.js"></script>
<script src="./src/component/common/bookmark-forum.js"></script>
<!-- <script src="./src/component/common/forum-new-post-modal.js"></script> -->
<script src="./src/component/common/report.js"></script>
<script src="./forum.js"></script> 

<script type="module">
    import forum from "./forum.js"
    let dummyData = [   //假資料
                {
                    "ArticleNumber": "1",
                    "AuthorName": "Maggie Wang1",
                    "AuthorAvatar": "./src/images/img/forum/smile.jpg",
                    "PostTime": "2021/09/21",
                    "ArticleTitle": "問題跑鞋標題",
                    "ArticleCategory": "問題",
                    "ArticleContent": "問題跑鞋內容",
                    "ViewsCount": "100",
                    "LikesCount": "100",
                    "CommentsCount": "100"
                },
                {
                    "ArticleNumber": "2",
                    "AuthorName": "Johnny Hsieh2",
                    "AuthorAvatar": "https://scontent.ftpe8-3.fna.fbcdn.net/v/t1.6435-9/122891827_3775399562473211_2678647114024992983_n.jpg?_nc_cat=107&ccb=1-5&_nc_sid=09cbfe&_nc_ohc=0Yscly8Bi6IAX_M7KPw&_nc_ht=scontent.ftpe8-3.fna&oh=14610ff24a6fa819b877c8142e2eea01&oe=61A500A6",
                    "PostTime": "2021/09/21",
                    "ArticleTitle": "閒聊跑鞋標題",
                    "ArticleCategory": "閒聊",
                    "ArticleContent": "閒聊跑鞋內容",
                    "ViewsCount": "200",
                    "LikesCount": "200",
                    "CommentsCount": "200"
                },
                {
                    "ArticleNumber": "3",
                    "AuthorName": "Johnny Hsieh3",
                    "AuthorAvatar": "https://scontent.ftpe8-3.fna.fbcdn.net/v/t1.6435-9/122891827_3775399562473211_2678647114024992983_n.jpg?_nc_cat=107&ccb=1-5&_nc_sid=09cbfe&_nc_ohc=0Yscly8Bi6IAX_M7KPw&_nc_ht=scontent.ftpe8-3.fna&oh=14610ff24a6fa819b877c8142e2eea01&oe=61A500A6",
                    "PostTime": "2021/09/21",
                    "ArticleTitle": "裝備跑鞋標題",
                    "ArticleCategory": "裝備",
                    "ArticleContent": "裝備跑鞋內容",
                    "ViewsCount": "300",
                    "LikesCount": "300",
                    "CommentsCount": "300"
                },
                {
                    "ArticleNumber": "4",
                    "AuthorName": "Johnny Hsieh4",
                    "AuthorAvatar": "https://scontent.ftpe8-3.fna.fbcdn.net/v/t1.6435-9/122891827_3775399562473211_2678647114024992983_n.jpg?_nc_cat=107&ccb=1-5&_nc_sid=09cbfe&_nc_ohc=0Yscly8Bi6IAX_M7KPw&_nc_ht=scontent.ftpe8-3.fna&oh=14610ff24a6fa819b877c8142e2eea01&oe=61A500A6",
                    "PostTime": "2021/09/21",
                    "ArticleTitle": "心得跑鞋標題",
                    "ArticleCategory": "心得",
                    "ArticleContent": "心得跑鞋內容",
                    "ViewsCount": "400",
                    "LikesCount": "400",
                    "CommentsCount": "400"
                },
                {
                    "ArticleNumber": "5",
                    "AuthorName": "Johnny Hsieh5",
                    "AuthorAvatar": "https://scontent.ftpe8-3.fna.fbcdn.net/v/t1.6435-9/122891827_3775399562473211_2678647114024992983_n.jpg?_nc_cat=107&ccb=1-5&_nc_sid=09cbfe&_nc_ohc=0Yscly8Bi6IAX_M7KPw&_nc_ht=scontent.ftpe8-3.fna&oh=14610ff24a6fa819b877c8142e2eea01&oe=61A500A6",
                    "PostTime": "2021/09/21",
                    "ArticleTitle": "心得跑鞋標題",
                    "ArticleCategory": "心得",
                    "ArticleContent": "心得跑鞋內容",
                    "ViewsCount": "500",
                    "LikesCount": "500",
                    "CommentsCount": "500"
                },
                {
                    "ArticleNumber": "6",
                    "AuthorName": "Johnny Walker6",
                    "AuthorAvatar": "https://scontent.ftpe8-3.fna.fbcdn.net/v/t1.6435-9/122891827_3775399562473211_2678647114024992983_n.jpg?_nc_cat=107&ccb=1-5&_nc_sid=09cbfe&_nc_ohc=0Yscly8Bi6IAX_M7KPw&_nc_ht=scontent.ftpe8-3.fna&oh=14610ff24a6fa819b877c8142e2eea01&oe=61A500A6",
                    "PostTime": "2021/09/21",
                    "ArticleTitle": "心得跑鞋標題",
                    "ArticleCategory": "心得",
                    "ArticleContent": "心得跑鞋內容",
                    "ViewsCount": "600",
                    "LikesCount": "600",
                    "CommentsCount": "600"
                },
            ];

    let dummyCommentData = [
        {
            "CommentId": "100",
            "AuthorName": "Johnny Hsieh1",
            "PostTime": "2021/09/21",
            "CommentContent": "留言內容留言內容"    
    
        },
        {
            "CommentId": "200",
            "AuthorName": "Johnny Hsieh2",
            "PostTime": "2021/09/21",
            "CommentContent": "留言內容留言內容"    
    
        }
    ];

    new Vue({
        el: "#forum-content",
        store: forum,
        data: {
            categories: ["全部","閒聊","裝備","心得","問題"],
            showPhotoBlock: false,
            showModal: false,
            likeSwitch: true,
            likeSwitchForRed: false,
            showReport: false,
            showReportModal: false,
            dataNumber: "",
            ArticleData: [],
            singleArticleData: [],
            commentData: [],
            showModal: false,

            forumTitle: "",
            category:"",
            articleContent:"",
        },
        methods: {
            openEditModal(){
                this.showModal = true;
            },
            closeEditModal(){         
                this.showModal = false;
            },
            clickLike(){
                this.likeSwitch = !this.likeSwitch;
                this.likeSwitchForRed = !this.likeSwitchForRed;
            },
            dropDownSwitch() {
                this.showReport = !this.showReport;
            },
            report() {
                this.showReportModal = true;
                console.log("ok");
            },
            closeReportModal() {
                this.showReportModal = false;
            },
            deletePost(){
                axios({
                method: "get",
                url: "./php/delete-forum.php",
                //API要求的資料
                data: {                       
                    postid: this.singleArticleData.PostID,
                },
                })
                .then((res) => console.log(res))
                .catch((error) => console.log(error))
            }
        },
        mounted() {  
            //從網址處拿到號碼，並將#號去掉
            let numberArray = location.hash.split("");
            numberArray.shift();
            for(let i = 0; i < numberArray.length; i++) {
                numberArray[i];
                this.dataNumber += numberArray[i]
                console.log(this.dataNumber);
            }

            axios.get('./php/select-forum.php')
            .then((res) => {
                this.articleData = res.data;
                //用號碼來找到相對應的資料
                for(let i = 0; i < this.articleData.length; i++) {
                    if(this.articleData[i].PostID.toString() === this.dataNumber.toString()) {
                        this.singleArticleData = this.articleData[i]; 
                    }
                }
            })
            .catch((error) => console.log(error))

            //找到本篇文章下的所有留言
            // axios.get('./php/select-comment.php')
            // .then((res) => {
            //     this.commentData = res.data;
            // })
            // .catch((error) => console.log(error))

            //圖片欄位出現與否
            if(this.singleArticleData.PostPhotoOne === false  && this.singleArticleData.PostPhotoTwo === false && this.singleArticleData.PostPhotoThree === false){
                this.showPhotoBlock = false;
            } else {
                this.showPhotoBlock = true;
            }
        },
    })
</script>

</body>
</html>